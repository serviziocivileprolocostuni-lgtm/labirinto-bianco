<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Tappa 12: Enigma</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
<style>
:root {
  --color-primary: #0C4B40;
  --color-accent: #C8AA6A;
  --color-frame: #bca44b;
  --color-bgbox: #fffded;
  --color-text: #44422c;
}
body {
  background: var(--color-frame);
  font-family: 'Quicksand', Arial, sans-serif;
  color: var(--color-text);
  min-height: 100vh;
  background-image: url('img/your-background.jpg');
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 25px 0;
  margin: 0;
}
.container {
  background: var(--color-bgbox);
  max-width: 700px;
  width: 100%;
  margin: 24px 8px;
  border-radius: 22px;
  box-shadow: 0 8px 40px #bca44b70;
  border: 6px solid var(--color-frame);
  padding: 36px 30px 40px 30px;
  text-align: center;
}
h1 {
  font-family: 'Playfair Display', serif;
  font-size: 2.6rem;
  color: var(--color-primary);
  margin-bottom: 20px;
  border-bottom: 2.5px solid var(--color-accent);
  padding-bottom: 7px;
}
.reference-section {
  text-align: left;
  font-family: 'Quicksand', Arial, sans-serif;
  font-size: 1.1rem;
  color: var(--color-text);
  line-height: 1.5;
  white-space: pre-line;
  margin-bottom: 30px;
}
label {
  font-family: 'Playfair Display', serif;
  font-weight: 700;
  font-size: 1.1rem;
  color: var(--color-accent);
  display: block;
  margin-bottom: 10px;
}
input[type="password"], input[type="text"] {
  width: 100%;
  font-family: inherit;
  font-size: 1.1rem;
  padding: 14px 16px;
  border-radius: 12px;
  border: 2px solid var(--color-accent);
  margin-bottom: 20px;
  box-sizing: border-box;
  background: #fffde7;
  color: var(--color-primary);
  letter-spacing: 0.5px;
}
input[type="password"]:focus, input[type="text"]:focus {
  border-color: var(--color-primary);
  background: #fdf6cd;
  outline: none;
}
button {
  width: 100%;
  font-family: 'Playfair Display', serif;
  font-weight: 700;
  font-size: 1.25rem;
  padding: 15px 0;
  background: var(--color-primary);
  border: none;
  border-radius: 15px;
  color: white;
  cursor: pointer;
  letter-spacing: 1px;
  box-shadow: 0 3px 12px #bca44b77;
  transition: background-color 0.3s;
  margin-top: 4px;
  margin-bottom: 20px;
}
button:hover:not(:disabled) {
  background-color: #165c4f;
}
button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
.choices { display: flex; justify-content: center; margin-bottom: 30px; flex-wrap: wrap; gap: 12px; }
.choice-btn {
  font-family: 'Playfair Display', serif;
  font-weight: 700;
  font-size: 1.1rem;
  color: var(--color-primary);
  padding: 13px 18px;
  border: 2px solid var(--color-accent);
  background: #fffde7;
  border-radius: 12px;
  cursor: pointer;
  box-shadow: 0 2px 10px #bca44b27;
  transition: background-color 0.3s, color 0.3s;
  min-width: 180px;
}
.choice-btn.selected {
  background-color: var(--color-primary);
  color: white;
  box-shadow: 0 0 18px var(--color-accent);
}
#penalty1 {
  display: none;
  color: #d32f2f;
  font-weight: 700;
  margin-bottom: 12px;
}
#status1 {
  color: var(--color-primary);
  font-weight: 700;
  min-height: 1.5em;
  margin-bottom: 10px;
}
#secondEnigmaSection, #finalCodeSection { display: none; }
</style>
</head>
<body>
<div class="container">
  <div id="introCode" class="intro-section">
    <h1>Tappa 12: Enigma </h1>
    <label for="codiceAccesso">Inserisci qui il codice segreto ottenuto alla fine della tappa precedente:</label>
    <input type="password" id="codiceAccesso" placeholder="Inserisci codice..." autocomplete="off" />
    <button id="unlockBtn" disabled>Sblocca</button>
    <div id="introStatus"></div>
  </div>
  <div id="step12" style="display:none;">
    <div class="reference-section">
      Le antiche mura di Ostuni, erette per proteggere la città, custodiscono un varco nascosto, simbolo del passaggio dalla storia al presente. Questa porta, poco conosciuta e ben celata, rappresenta l’accesso all’ultima sfida per chi ha seguito il cammino con attenzione.
    </div>
    <form id="enigma1Form" autocomplete="off">
      <p><strong>Enigma 1:</strong> La Porta San Demetrio proteggeva l’accesso alla città verso quale importante località?</p>
      <div class="choices">
        <button type="button" class="choice-btn" value="brindisi">Brindisi</button>
        <button type="button" class="choice-btn" value="lecce">Lecce</button>
        <button type="button" class="choice-btn" value="bari">Bari</button>
      </div>
      <p id="penalty1">Risposta sbagliata! Riprova tra <span id="countdown1">30</span> secondi.</p>
      <p id="status1"></p>
      <button type="submit" id="submitBtn1" disabled>Verifica Risposta</button>
    </form>
    <div id="secondEnigmaSection">
      <p><strong>Enigma 2 (prova fisica):</strong> Il narratore errante farà il suo ingresso, vi chiederà una prova finale e vi consegnerà il codice della vittoria.</p>
    </div>
    <div id="finalCodeSection" style="margin-top:30px; padding:20px; border:2px solid var(--color-primary); border-radius:15px; background:#fffbea;">
      <h2>Chiusura caccia al tesoro</h2>
      <p>Inserisci il codice segreto finale per completare la caccia e registrare la tua squadra.</p>
      <form id="finalForm" autocomplete="off">
        <input type="text" id="teamName" placeholder="Nome squadra" required />
        <input type="text" id="secretCode" placeholder="Codice segreto" required />
        <button type="submit">Invia codice e completa</button>
      </form>
      <div id="finalStatus"></div>
    </div>
  </div>
</div>
<script>
// Sblocco step
const unlockBtn = document.getElementById('unlockBtn');
const codiceAccesso = document.getElementById('codiceAccesso');
const introCode = document.getElementById('introCode');
const step12 = document.getElementById('step12');
unlockBtn.disabled = true;
codiceAccesso.addEventListener('input', () => { unlockBtn.disabled = codiceAccesso.value.trim() === ''; });
unlockBtn.addEventListener('click', e => {
  e.preventDefault();
  if (codiceAccesso.value.trim().toLowerCase() === 'fede') {
    introCode.style.display = 'none';
    step12.style.display = 'block';
  } else {
    document.getElementById('introStatus').textContent = 'Codice non valido! Riprova.';
    codiceAccesso.value = '';
    unlockBtn.disabled = true;
    setTimeout(() => document.getElementById('introStatus').textContent = '', 3000);
  }
});

// Enigma 1 penalità
const enigma1Form = document.getElementById('enigma1Form');
const choiceBtns = enigma1Form.querySelectorAll('.choice-btn');
const submitBtn1 = document.getElementById('submitBtn1');
const penalty1 = document.getElementById('penalty1');
const status1 = document.getElementById('status1');
const countdown1 = document.getElementById('countdown1');

choiceBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    choiceBtns.forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    submitBtn1.disabled = false;
    status1.textContent = '';
  });
});

function startPenalty() {
  let sec = 30;
  penalty1.style.display = 'block';
  submitBtn1.disabled = true;
  choiceBtns.forEach(b => b.disabled = true);
  countdown1.textContent = sec;
  const interval = setInterval(() => {
    sec--;
    countdown1.textContent = sec;
    if (sec <= 0) {
      clearInterval(interval);
      penalty1.style.display = 'none';
      submitBtn1.disabled = false;
      choiceBtns.forEach(b => b.disabled = false);
      choiceBtns.forEach(b => b.classList.remove('selected'));
    }
  }, 1000);
}

enigma1Form.addEventListener('submit', e => {
  e.preventDefault();
  const correct = 'brindisi';
  const selected = enigma1Form.querySelector('.choice-btn.selected');
  if (!selected) {
    status1.textContent = 'Seleziona una risposta!';
    status1.style.color = '#d32f2f';
    return;
  }
  if (selected.value !== correct) {
    startPenalty();
    status1.textContent = '';
    return;
  }
  status1.textContent = 'Risposta corretta! Il narratore errante farà il suo ingresso per la prova finale.';
  status1.style.color = 'var(--color-primary)';
  document.getElementById('secondEnigmaSection').style.display = 'block';
  document.getElementById('finalCodeSection').style.display = 'block';
  submitBtn1.disabled = true;
  choiceBtns.forEach(b => b.disabled = true);
});

// Form finale: redirect con nome squadra all’attestato
document.getElementById('finalForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const team = document.getElementById('teamName').value.trim();
  const code = document.getElementById('secretCode').value.trim().toLowerCase();
  if (!team || !code) {
    document.getElementById('finalStatus').textContent = 'Compila entrambi i campi!';
    document.getElementById('finalStatus').style.color = 'red';
    return;
  }
  if (code !== 'vittoria') {
    document.getElementById('finalStatus').textContent = 'Codice errato. Riprova.';
    document.getElementById('finalStatus').style.color = 'red';
    return;
  }
  window.location.href = 'classifica.html?squadra=' + encodeURIComponent(team);
});
</script>
</body>
</html>
