<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Tappa 10: Enigma </title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
<style>
  :root {
    --color-primary: #0C4B40;
    --color-accent: #C8AA6A;
    --color-frame: #bca44b;
    --color-bgbox: #fffded;
    --color-text: #44422c;
  }
  body {
    background: var(--color-frame);
    font-family: 'Quicksand', Arial, sans-serif;
    color: var(--color-text);
    min-height: 100vh;
    background-image: url('img/your-background.jpg');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 25px 0;
    margin: 0;
  }
  .container {
    background: var(--color-bgbox);
    max-width: 700px;
    width: 100%;
    margin: 24px 8px;
    border-radius: 22px;
    box-shadow: 0 8px 40px #bca44b70;
    border: 6px solid var(--color-frame);
    padding: 36px 30px 40px 30px;
    text-align: center;
  }
  h1 {
    font-family: 'Playfair Display', serif;
    font-size: 2.6rem;
    color: var(--color-primary);
    margin-bottom: 20px;
    border-bottom: 2.5px solid var(--color-accent);
    padding-bottom: 7px;
  }
  .intro-section {
    margin-bottom: 36px;
    text-align: center;
  }
  .reference-section {
    text-align: left;
    font-family: 'Quicksand', Arial, sans-serif;
    font-size: 1.1rem;
    color: var(--color-text);
    line-height: 1.5;
    white-space: pre-line;
    margin-bottom: 30px;
  }
  label {
    font-family: 'Playfair Display', serif;
    font-weight: 700;
    font-size: 1.1rem;
    color: var(--color-accent);
    display: block;
    margin-bottom: 10px;
  }
  input[type="password"], input[type="text"] {
    width: 100%;
    font-family: inherit;
    font-size: 1.1rem;
    padding: 14px 16px;
    border-radius: 12px;
    border: 2px solid var(--color-accent);
    margin-bottom: 20px;
    box-sizing: border-box;
    background: #fffde7;
    color: var(--color-primary);
    letter-spacing: 0.5px;
  }
  input[type="password"]:focus, input[type="text"]:focus {
    border-color: var(--color-primary);
    background: #fdf6cd;
    outline: none;
  }
  button {
    width: 100%;
    font-family: 'Playfair Display', serif;
    font-weight: 700;
    font-size: 1.25rem;
    padding: 15px 0;
    background: var(--color-primary);
    border: none;
    border-radius: 15px;
    color: white;
    cursor: pointer;
    letter-spacing: 1px;
    box-shadow: 0 3px 12px #bca44b77;
    transition: background-color 0.3s;
    margin-top: 4px;
    margin-bottom: 20px;
  }
  button:hover:not(:disabled) {
    background-color: #165c4f;
  }
  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  #introStatus, #penalty1, #penalty2, #status1, #status2 {
    font-weight: 700;
    min-height: 1.5em;
    margin-bottom: 18px;
    text-align: center;
  }
  #introStatus, #penalty1, #penalty2 {
    color: #d32f2f;
  }
  #status1, #status2 {
    color: var(--color-primary);
  }
  .choices {
    display: flex;
    justify-content: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 12px;
  }
  .choice-btn {
    font-family: 'Playfair Display', serif;
    font-weight: 700;
    font-size: 1.1rem;
    color: var(--color-primary);
    padding: 13px 18px;
    border: 2px solid var(--color-accent);
    background: #fffde7;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 2px 10px #bca44b27;
    transition: background-color 0.3s, color 0.3s;
    min-width: 180px;
  }
  .choice-btn.selected {
    background-color: var(--color-primary);
    color: white;
    box-shadow: 0 0 18px var(--color-accent);
  }
  #penalty1, #penalty2 {
    display: none;
  }
  #secondEnigmaSection {
    display: none;
    margin-top: 36px;
    padding: 26px 20px;
    background: #fffbea;
    border: 2px solid var(--color-primary);
    border-radius: 15px;
    box-shadow: inset 0 0 15px #bca44b22;
  }
  #bonusSection {
    display: none;
    margin-top: 36px;
    padding: 26px 20px;
    background: #fffbea;
    border: 2px solid var(--color-accent);
    border-radius: 15px;
    box-shadow: inset 0 0 15px #bca44b33;
    font-family: 'Quicksand', Arial, sans-serif;
    font-size: 1rem;
    color: var(--color-text);
  }
  #codiceSegreto {
    display: none;
    font-family: 'Playfair Display', serif;
    font-weight: 900;
    font-size: 2rem;
    letter-spacing: 8px;
    color: var(--color-primary);
    text-shadow: 1px 1px 0 var(--color-accent);
    margin-top: 24px;
    user-select: all;
  }
  #codiceSegreto.visible {
    display: block;
  }
</style>
</head>
<body>

<div class="container">

  <div id="introCode" class="intro-section">
    <h1>Tappa 10: Enigma </h1>
    <label for="codiceAccesso">Inserisci qui il codice segreto ottenuto alla fine della tappa precedente:</label>
    <input type="password" id="codiceAccesso" placeholder="Inserisci codice..." autocomplete="off" />
    <button id="unlockBtn" disabled>Sblocca</button>
    <div id="introStatus"></div>
  </div>

  <div id="step10" class="hidden">
    <div class="reference-section">
      La Colonna di Sant’Oronzo è un importante monumento situato nella Piazza dedicata al santo patrono di Ostuni, venerato fin dall'antichità come protettore della città da calamità e disgrazie. Questo monumento fu eretto nel corso del XVIII secolo come segno tangibile della devozione popolare e della gratitudine verso Sant’Oronzo, che secondo la tradizione avrebbe salvato Ostuni da pestilenze e calamità naturali. La colonna è costituita da una base solida, spesso decorata con simboli sacri e stemmi religiosi, sorregge una statua o un simbolo che richiama alla figura del santo, punto di riferimento per i fedeli locali. Intorno alla colonna si svolgono festività e processioni che rafforzano l’identità religiosa e culturale della comunità ostunese.
    </div>

    <form id="enigma1Form" autocomplete="off">
      <p><strong>Enigma Il Santo Patrono 1:</strong> Difronte a voi si innanza la colonna barocca di Sant'Oronzo, eretta nel 1771 per ricordare la protezione del patrono durante la peste. Guardatela con attenzione: solo così scoprirete il codice che vi permetterà di proseguire.</p>
      <p>Quanti angeli scolpiti circondano la base della colonna?</p>
      <div class="choices">
        <button type="button" class="choice-btn" value="2">2</button>
        <button type="button" class="choice-btn" value="4">4</button>
        <button type="button" class="choice-btn" value="6">6</button>
      </div>
      <p id="penalty1">Risposta sbagliata! Riprova tra <span id="countdown1">15</span> secondi.</p>
      <p id="status1"></p>
      <button type="submit" id="submitBtn1" disabled>Verifica Risposta</button>
    </form>

    <div id="secondEnigmaSection">
      <form id="enigma2Form" autocomplete="off">
        <p><strong>Enigma Il codice del protettore 2:</strong> Sant'Oronzo fu proclamato protettore di Ostuni nel 1657, dopo la peste. La colonna fu completata nel 1771. In cima, la statua del Santo benedice con la mano destra. Alla base, quattro angeli sorreggono il monumento nella città di Ostuni.</p>
        <p>Calcola: (1771 - 1657) + numero lettere "OSTUNI" (6) diviso numero lettere "ORONZO" (6). Qual è il numero finale?</p>
        <div class="choices">
          <button type="button" class="choice-btn" value="18">18</button>
          <button type="button" class="choice-btn" value="20">20</button>
          <button type="button" class="choice-btn" value="22">22</button>
        </div>
        <p id="penalty2">Risposta sbagliata! Riprova tra <span id="countdown2">15</span> secondi.</p>
        <p id="status2"></p>
        <button type="submit" id="submitBtn2" disabled>Verifica Risposta</button>
      </form>
    </div>

    <div id="bonusSection">
      <h2>Bonus</h2>
      <p>Il vostro cammino vi conduce verso la Chiesa del Carmine, custode di antiche confraternite. Cercate con attenzione, la verità non sempre parla, ma qui si nasconde!</p>
      <div id="codiceSegreto">patrono</div>
    </div>

  </div>

</div>

<form id="hiddenDataForm" target="hiddenIframe" method="POST" autocomplete="off" action="https://docs.google.com/forms/d/e/your-google-form-id/formResponse" style="display:none;">
  <input type="text" name="entry.2030348205" id="hiddenNomeSquadra" />
  <input type="text" name="entry.2106200479" id="hiddenCodiceTappa" />
  <input type="text" name="entry.1130952224" id="hiddenCodiceSegreto" />
</form>
<iframe name="hiddenIframe" style="display:none;"></iframe>

<script>
  const unlockBtn = document.getElementById('unlockBtn');
  const codiceAccesso = document.getElementById('codiceAccesso');
  const introStatus = document.getElementById('introStatus');
  const introCode = document.getElementById('introCode');
  const step10 = document.getElementById('step10');

  const enigma1Form = document.getElementById('enigma1Form');
  const enigma2Form = document.getElementById('enigma2Form');
  const secondEnigmaSection = document.getElementById('secondEnigmaSection');
  const bonusSection = document.getElementById('bonusSection');
  const codiceSegretoDiv = document.getElementById('codiceSegreto');

  const submitBtn1 = document.getElementById('submitBtn1');
  const submitBtn2 = document.getElementById('submitBtn2');

  const choiceBtnsEnigma1 = enigma1Form.querySelectorAll('.choice-btn');
  const choiceBtnsEnigma2 = enigma2Form.querySelectorAll('.choice-btn');

  const penalty1 = document.getElementById('penalty1');
  const penalty2 = document.getElementById('penalty2');

  const status1 = document.getElementById('status1');
  const status2 = document.getElementById('status2');

  const countdown1 = document.getElementById('countdown1');
  const countdown2 = document.getElementById('countdown2');

  const hiddenForm = document.getElementById('hiddenDataForm');
  const hiddenNomeSquadra = document.getElementById('hiddenNomeSquadra');
  const hiddenCodiceTappa = document.getElementById('hiddenCodiceTappa');
  const hiddenCodiceSegreto = document.getElementById('hiddenCodiceSegreto');

  unlockBtn.disabled = true;
  codiceAccesso.addEventListener('input', () => {
    unlockBtn.disabled = codiceAccesso.value.trim() === '';
  });

  step10.style.display = 'none';
  submitBtn1.disabled = true;
  submitBtn2.disabled = true;
  penalty1.style.display = 'none';
  penalty2.style.display = 'none';
  secondEnigmaSection.style.display = 'none';
  bonusSection.style.display = 'none';
  codiceSegretoDiv.classList.remove('visible');

  unlockBtn.addEventListener('click', e => {
    e.preventDefault();
    const codice = codiceAccesso.value.trim().toLowerCase();
    if (codice === 'comune') {
      introCode.style.display = 'none';
      step10.style.display = 'block';
      choiceBtnsEnigma1.forEach(b => b.disabled = false);
      choiceBtnsEnigma2.forEach(b => b.disabled = true);
    } else {
      introStatus.textContent = 'Codice non valido! Riprova.';
      codiceAccesso.value = '';
      unlockBtn.disabled = true;
      setTimeout(() => introStatus.textContent = '', 3000);
    }
  });

  choiceBtnsEnigma1.forEach(btn => {
    btn.addEventListener('click', () => {
      choiceBtnsEnigma1.forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      submitBtn1.disabled = false;
      status1.textContent = '';
    });
  });

  choiceBtnsEnigma2.forEach(btn => {
    btn.addEventListener('click', () => {
      choiceBtnsEnigma2.forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      submitBtn2.disabled = false;
      status2.textContent = '';
    });
  });

  function startPenalty(penaltyElem, submitBtn, choiceBtns, countdownElem) {
    let sec = 15;
    penaltyElem.style.display = 'block';
    submitBtn.disabled = true;
    choiceBtns.forEach(b => b.disabled = true);
    countdownElem.textContent = sec;
    const interval = setInterval(() => {
      sec--;
      countdownElem.textContent = sec;
      if (sec <= 0) {
        clearInterval(interval);
        penaltyElem.style.display = 'none';
        submitBtn.disabled = false;
        choiceBtns.forEach(b => b.disabled = false);
        choiceBtns.forEach(b => b.classList.remove('selected'));
      }
    }, 1000);
  }

  enigma1Form.addEventListener('submit', e => {
    e.preventDefault();
    const correctAnswer1 = '4';
    const selected = enigma1Form.querySelector('.choice-btn.selected');
    if (!selected) {
      status1.textContent = 'ERRORE: seleziona una risposta.';
      status1.style.color = '#d32f2f';
      return;
    }
    if (selected.value !== correctAnswer1) {
      startPenalty(penalty1, submitBtn1, choiceBtnsEnigma1, countdown1);
      status1.textContent = '';
      return;
    }
    status1.textContent = 'Risposta corretta! Puoi procedere al secondo enigma.';
    status1.style.color = 'var(--color-primary)';
    secondEnigmaSection.style.display = 'block';

    submitBtn1.disabled = true;
    choiceBtnsEnigma1.forEach(b => b.disabled = true);

    choiceBtnsEnigma2.forEach(b => b.disabled = false);
  });

  enigma2Form.addEventListener('submit', e => {
    e.preventDefault();
    const correctAnswer2 = '20';
    const selected = enigma2Form.querySelector('.choice-btn.selected');
    if (!selected) {
      status2.textContent = 'ERRORE: seleziona una risposta.';
      status2.style.color = '#d32f2f';
      return;
    }
    if (selected.value !== correctAnswer2) {
      startPenalty(penalty2, submitBtn2, choiceBtnsEnigma2, countdown2);
      status2.textContent = '';
      return;
    }
    status2.textContent = 'Risposta corretta! Complimenti, hai sbloccato il bonus!';
    status2.style.color = 'var(--color-primary)';
    submitBtn2.disabled = true;
    choiceBtnsEnigma2.forEach(b => b.disabled = true);
    bonusSection.style.display = 'block';
    codiceSegretoDiv.classList.add('visible');

    hiddenNomeSquadra.value = document.getElementById('nomeSquadraInput').value.trim();
    hiddenCodiceTappa.value = 'Tappa_10';
    hiddenCodiceSegreto.value = 'patrono';
    hiddenForm.submit();
  });

  window.addEventListener('DOMContentLoaded', () => {
    let squadra = new URLSearchParams(window.location.search).get('squadra');
    if (!squadra) squadra = localStorage.getItem('nomeSquadra');
    if (squadra) {
      document.getElementById('nomeSquadraInput').value = decodeURIComponent(squadra);
      localStorage.setItem('nomeSquadra', decodeURIComponent(squadra));
    }
  });
</script>

</body>
</html>
